# concurrent_data_downloader.py

### üîÑ –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—ã–≥—Ä—É–∑–∫–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ OpenSearch/Elasticsearch  
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ETL-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∑–∞–º–µ—Ä–æ–≤ –ø–∞–º—è—Ç–∏ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
–≠—Ç–æ –æ–±—ë—Ä—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `get_dataframe`, —è–≤–ª—è—é—â–µ–π—Å—è —á–∞—Å—Ç—å—é –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å OpenSearch —á–µ—Ä–µ–∑ Python.

---

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`concurrent_data_downloader.py` ‚Äî —ç—Ç–æ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–æ–≥ –≤—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ Python-–º–æ–¥—É–ª—è (–Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –º–Ω–æ–π) –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ OpenSearch, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é:

- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º –≤—Ä–µ–º–µ–Ω–∏;
- –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ `ThreadPoolExecutor`;
- —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `.pkl`;
- —Å–±–æ—Ä–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ `.csv` –∏–ª–∏ `DataFrame`;
- –≥–∏–±–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–∞–º—è—Ç–∏, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏–º–µ–Ω—è–ª—Å—è –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π ETL-—Å–∏—Å—Ç–µ–º–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `index-2024.03`, `index-2024.03.12`).

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å                      | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 | –ö–∞–∫—É—é –∑–∞–¥–∞—á—É —Ä–µ—à–∞–µ—Ç                                      |
|---------------------------------|--------------------------------------------------------------------------|----------------------------------------------------------|
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `QueryConfigurator` | –ö–ª–∞—Å—Å —Å –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞: –ø–æ–ª—è, —Ñ–∏–ª—å—Ç—Ä—ã, –ª–æ–≥–∏–∫–∞, —Ä–µ–∂–∏–º—ã –≤—ã–≤–æ–¥–∞, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ | –£–ø—Ä–æ—â–µ–Ω–∏–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —É–¥–æ–±–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è     |
| –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤         | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–º–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ —á–∞—Å–∞–º/–¥–Ω—è–º —Å —É—á—ë—Ç–æ–º `gte/lte`                 | –†–∞–∑–±–∏–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –º–Ω–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–∏—Ö –Ω–µ–ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏—Ö—Å—è –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤ |
| –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å               | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤                     | –ö—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Å—á—ë—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞            |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ                  | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—ã–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö `.pkl`                    | –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö        |
| –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä                 | `tqdm` —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π –¥–ª—è Airflow (stub-–ø—Ä–æ–≥—Ä–µ—Å—Å)                       | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞     |
| –ó–∞–º–µ—Ä –ø–∞–º—è—Ç–∏                 | –í –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ ‚Äî –ª–æ–≥ –ø–∏–∫–æ–≤–æ–≥–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è                            | –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤           |
| –ì–∏–±–∫–∏–π –ª–æ–≥–≥–µ—Ä                 | `basic`, `detailed`, `extra`, `full` ‚Äî —Å –≤—ã–≤–æ–¥–æ–º –≤ —Ñ–∞–π–ª/–∫–æ–Ω—Å–æ–ª—å          | –î–µ—Ç–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç –∏ –æ—Ç–ª–∞–¥–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã                 |
| –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π | –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ —Ñ–ª–∞–≥—É                            | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤—ã–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —á–∏—Å—Ç–æ—Ç—ã   |
| –î–∞—É–Ω–∫–∞—Å—Ç–∏–Ω–≥ —Ç–∏–ø–æ–≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ DataFrame, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `int64` –≤ `int32` –∏–ª–∏ `object` –≤ `category` | –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ |
| –ü–æ–∫—É—Å–æ—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ —Ñ–∞–π–ª–∞ –∏–ª–∏ DataFrame | –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ —á–∞—Å—Ç—è–º (—á–∞–Ω–∫–∞–º): –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ —Ñ–∞–π–ª –¥–∞–Ω–Ω—ã–µ –¥–æ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞, –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ DataFrame ‚Äî –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—ç—Ç–∞–ø–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤ | –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–±—ä—ë–º—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –æ–±—ä—ë–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏, —Å–Ω–∏–∂–∞–µ—Ç –ø–∏–∫–æ–≤—É—é –Ω–∞–≥—Ä—É–∑–∫—É |

--- 

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –±–ª–æ–∫–∏

### `QueryConfigurator`  
–£–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π: –ø–æ–ª—è, —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π, —É—Å–ª–æ–≤–∏—è, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö, –ª–æ–≥–≥–∏–Ω–≥, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏ —Ñ–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

### `prepare_queries()`  
–†–∞–∑–±–∏–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –Ω–∞ –ø–æ–¥–ø–µ—Ä–∏–æ–¥—ã –∏ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –¥–Ω–µ–≤–Ω—ã–µ, —Ç–∞–∫ –∏ –º–µ—Å—è—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã.

### `download_data_parallel()`  
–û—Å–Ω–æ–≤–Ω–æ–π –¥–≤–∏–∂–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏:
- –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Ç–æ–∫–∏;
- –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –∑–∞–¥–∞—á—É (`_process_single_query`);
- –ª–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—Ö–∏ –∏ –æ—à–∏–±–∫–∏;
- —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `.csv` –∏–ª–∏ `DataFrame`.

### –£—Ç–∏–ª–∏—Ç—ã:
- `optimize_dataframe()` ‚Äî —Å–∂–∞—Ç–∏–µ —Ç–∏–ø–æ–≤ –¥–æ —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã—Ö;
- `aggregate_data_to_variable()` ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö `.pkl` –≤ –∏—Ç–æ–≥–æ–≤—ã–π DataFrame;
- `validate_fields()` ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π;
- `write_instance_info()` ‚Äî –∑–∞–ø–∏—Å—å INFO.md —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –æ –∑–∞–ø—Ä–æ—Å–µ.

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

![alt text](/src/image.png)
- 9124 –º–∏–ª–ª–∏–æ–Ω–æ–≤ (9,124,000,000) —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–æ –≤—ã–≥—Ä—É–∂–µ–Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞–º–∏ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 180 –¥–Ω–µ–π –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

![alt text](/src/sleekshot.png)
- –í—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 180 –¥–Ω–µ–π –ø—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –∑–∞–Ω—è–ª–∞ –±—ã –æ–∫–æ–ª–æ 1639 —á–∞—Å–æ–≤ (68 –¥–Ω–µ–π). –ó–∞ —Å—á—ë—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º—è –≤—ã–≥—Ä—É–∑–∫–∏ —É–¥–∞–ª–æ—Å—å —Å–æ–∫—Ä–∞—Ç–∏—Ç—å **–º–∏–Ω–∏–º—É–º** –≤ 30 —Ä–∞–∑ ‚Äî –¥–æ 2,27 –¥–Ω–µ–π. –ü—Ä–∏ —ç—Ç–æ–º, –≤–º–µ—Å—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö 30 –ø–æ—Ç–æ–∫–æ–≤, –º–Ω–æ–≥–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ 50‚Äì70 –ø–æ—Ç–æ–∫–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –µ—â—ë –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏.